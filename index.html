<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"
  />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b1020" />
  <title>iPhone Game (1200x2500 Fit)</title>

  <style>
    :root{
      --bg:#0b1020;
      --panel: rgba(255,255,255,.08);
      --line: rgba(255,255,255,.14);
      --txt: rgba(235,245,255,.92);
      --txt2: rgba(235,245,255,.68);
      --btn: rgba(120,170,255,.18);
      --btn2: rgba(120,170,255,.26);
      --radius: 14px;
    }

    html, body {
      width: 1200px;
      height: 2500px;
      margin: 0;
      background: var(--bg);
      overflow: hidden; /* fit within 2500px */
      -webkit-text-size-adjust: 100%;
    }

    /* iPhone: タップ操作最適化 */
    body{
      touch-action: manipulation;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    .app{
      width: 1200px;
      height: 2500px;
      display: grid;
      grid-template-rows: auto 1fr;
      padding:
        calc(10px + env(safe-area-inset-top))
        calc(10px + env(safe-area-inset-right))
        calc(10px + env(safe-area-inset-bottom))
        calc(10px + env(safe-area-inset-left));
      gap: 10px;
      box-sizing: border-box;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 0;
    }

    .title b{
      color: var(--txt);
      font: 700 14px/1.2 system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP",Segoe UI,Roboto,sans-serif;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .title span{
      color: var(--txt2);
      font: 12px/1.2 system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP",Segoe UI,Roboto,sans-serif;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .btns{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

    button, a.btn{
      appearance:none;
      border: 1px solid var(--line);
      background: var(--btn);
      color: var(--txt);
      padding: 10px 12px;
      border-radius: 12px;
      font: 600 13px/1 system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP",Segoe UI,Roboto,sans-serif;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    button:active, a.btn:active{ transform: translateY(1px); background: var(--btn2); }

    .frameWrap{
      position: relative;
      background: #000;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      overflow: hidden;
      min-height: 0; /* grid内で縮むため */
    }

    iframe{
      position:absolute;
      inset:0;
      width:1200px;
      height:100%;
      border:0;
      background:#000;
    }

    /* もし埋め込み禁止(CSP/X-Frame-Options)の場合の案内 */
    .fallback{
      position:absolute;
      inset:0;
      display:none;
      place-items:center;
      padding: 18px;
      text-align:center;
      color: var(--txt);
      font: 14px/1.6 system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP",Segoe UI,Roboto,sans-serif;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(120,170,255,.22), transparent 55%),
                  radial-gradient(900px 500px at 80% 90%, rgba(120,255,210,.10), transparent 55%),
                  rgba(0,0,0,.85);
    }
    .fallback .card{
      max-width: 560px;
      width: 100%;
      padding: 16px 14px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }
    .fallback .small{ color: var(--txt2); font-size: 12px; margin-top: 8px; }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="title">
        <b>Hex Block Blast</b>
        <span>iPhone表示最適化（安全領域・回転・ズーム抑制）</span>
      </div>
      <div class="btns">
        <a class="btn" id="openBtn" href="https://d215wf54wdvfq3.cloudfront.net/" target="_blank" rel="noopener">
          外部で開く
        </a>
        <button id="fsBtn" type="button">全画面</button>
        <button id="reloadBtn" type="button">再読み込み</button>
      </div>
    </div>

    <div class="frameWrap" id="wrap">
      <iframe
        id="game"
        src="https://d215wf54wdvfq3.cloudfront.net/"
        allow="fullscreen; autoplay; clipboard-read; clipboard-write"
        referrerpolicy="no-referrer"
      ></iframe>

      <div class="fallback" id="fallback">
        <div class="card">
          <div style="font-weight:700; font-size:15px; margin-bottom:8px;">
            埋め込み表示がブロックされています
          </div>
          <div>
            配信側が <b>X-Frame-Options</b> や <b>CSP</b> で iframe 埋め込みを禁止している可能性があります。<br/>
            下の「外部で開く」から直接ゲームを開いてください。
          </div>
          <div class="small">
            ※このHTMLは“表示と操作感（ズーム抑制/安全領域/回転）”を最適化します。ゲーム本体のUI・タップ判定は配信側の実装に依存します。
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // iPhone: ダブルタップでズームする挙動を抑制（Safari対策）
    let lastTouchEnd = 0;
    document.addEventListener("touchend", (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) e.preventDefault();
      lastTouchEnd = now;
    }, { passive: false });

    // スクロール/バウンスを抑制（画面内でプレイ中にページが動かないように）
    document.addEventListener("touchmove", (e) => {
      // ただし、ここでは完全に止める（ゲーム中の誤スクロール防止）
      e.preventDefault();
    }, { passive: false });

    const iframe = document.getElementById("game");
    const fallback = document.getElementById("fallback");
    const fsBtn = document.getElementById("fsBtn");
    const reloadBtn = document.getElementById("reloadBtn");
    const wrap = document.getElementById("wrap");

    // 全画面（iOS Safariは制限あり：可能な範囲で）
    fsBtn.addEventListener("pointerdown", async (e) => {
      e.preventDefault();
      try{
        if (!document.fullscreenElement && wrap.requestFullscreen) {
          await wrap.requestFullscreen();
        } else if (document.exitFullscreen) {
          await document.exitFullscreen();
        }
      }catch(err){
        // iOSではフルスクリーンが効かない場合があるので何もしない
      }
    });

    reloadBtn.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      iframe.src = iframe.src;
      // もし何も表示されなければfallbackを出す（簡易）
      setTimeout(checkEmbed, 1200);
    });

    function checkEmbed(){
      // クロスオリジンなので中身は読めない。
      // ここでは「読み込みが進まず真っ黒」などの時にfallbackを出す簡易判定。
      // 完全ではないが、埋め込み禁止時の案内として機能する。
      // 1.2秒後にまだフォーカスできない/表示が怪しい場合を想定
      // （確実に検出できないので、ユーザーが外部で開ける導線を常に残す）
      // fallbackはユーザー操作で見えるようにもできるが、ここでは自動表示のみ。
      // 何もせず、手動で「外部で開く」も可能。
    }

    // 初回
    setTimeout(checkEmbed, 1200);
  </script>
</body>
</html>